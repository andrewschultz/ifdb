<?php

include_once "session-start.php";
include_once "dbconnect.php";
include_once "util.php";
include "pagetpl.php";
include_once "login-persist.php";
include "newitems.php";
include_once "commentutil.php";

$db = dbConnect();

$uid = checkPersistentLogin();
$quid = mysql_real_escape_string($uid, $db);

$loggedIn = (isset($_SESSION['logged_in']) && $_SESSION['logged_in']);

$adminPriv = false;
$caughtUpDate = false;

if ($uid) {
    $result = mysql_query(
        "select `privileges`, caughtupdate from users where id='$quid'", $db);
    $priv = mysql_result($result, 0, "privileges");
    $adminPriv = (strpos($priv, "A") !== false);
    $caughtUpDate = mysql_result($result, 0, "caughtupdate");
    }

$debugflag = $adminPriv && get_req_data('debug') == 'yesDebug';
if ($debugflag) echo "debug mode enabled...<br>";
?>

<?php pageHeader("The Interactive Fiction Database - IF and Text Adventures")?>

<div class="flexer">
    <div class="column main-col">
        <div class="block">
            <div class="headline headline1">
                Welcome to IFDB!
                <span class="headlineRss">
                    <a href="news">Site News</a> |
                    <a href="news?rss"><img src="blank.gif" class="rss-icon">RSS Feed</a>
                </span>
            </div>
            <p>The Interactive Fiction Database is an IF game catalog and recommendation engine. IFDB is a Wiki-style community project: members can add new game listings, write reviews, exchange game recommendations, and more. <span class="details"><a href="tips">Tips & More Info</a></span></p> 
        </div>
        

        <?php //include "components/check-inbox.php"?>

        <div class="block">
            <div class=headline>New on IFDB
                <span class=headlineRss>
                    <a href="allnew-rss"><img src="blank.gif" class="rss-icon">RSS Feed</a>
                </span>
            </div>

            <?php if (!$db) {
                echo "<span class=errmsg>An error occurred connecting to the database. Please try again later, or <a href=\"contact\">contact us</a> if the problem persists.<span>";
            }
            else {
                if (showNewItems($db, 0, 5, false, false, false))
                echo "<p><span class=details><a href=\"allnew\">". "See the full list...</a></span></p>";}
            ?>
        </div>


        <div class=flexer>
            <div class="column main-col">
                <h2 class="headline">Vote!</h2>
                <?php include "components/poll-sampler.php"?>
            </div>
            
            <div class="column sidebar-col">
                <h2 class="headline">New to IF?</h2>
                The IFDB <b>Download Adviser</b> can help get you up and running with the games you find on IFDB. Just click <img src="dlhelpbtn.gif" align="absmiddle" alt='The "Show me how!" button'> in any game's Download box for customized, step-by-step instructions for running the game on your system.
            </div>
        </div>

        <div class="block">
            <h2 class="headline">IFDB recommends...</h2>
            <?php include "components/ifdb-recommends.php"?>
        </div>

    </div>

    <div class="column sidebar-col">

        <div class="aside-box">
            <?php include "components/control-panel.php"?>
        </div>

        <div class="aside-box">
            <h3>Reviewer Trophy Room</h3>
            <?php include "components/reviewer-trophy-room.php"?>
        </div>

        <?php if (!$loggedIn)?>
        <div class="aside-box">
            <h3>Join IFDB!</h3>
            IFDB isn't just for reading about IF - you can also share your opinions about your favorite games. Members can write reviews, create Recommended Lists, add and edit game listings, and more. Membership is free and only takes a few moments to set up.
            <a href="newuser">Sign up now!</a>
        </div>
        <?php ?>

        <div class="aside-box">
            <h3>In the Database</h3>
            <?php include "components/in-the-database.php"?>
        </div>
    </div>  
</div>

<?php pageFooter()?>